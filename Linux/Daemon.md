# Daemon
> 배경으로 동작하는 프로세스

### 요구사항
1. init 의 자식 프로세스로 동작할 것
2. 터미널에 연결하면 안 됨
	- ctrl+c 를 입력하여 프로세스를 종료시키는 등, 외부 명령으로 인한 종료를 막기 위해 제어 터미널과 연결되지 않아야 한다.

## 1. 데몬이 되기 위한 단계
#### 1) fork() : 새로 데몬이 될 프로세스를 만든다.

#### 2) 부모 프로세스에서 exit() 호출
- 할아버지 - **부모** - 자식(데몬) => 부모 프로세스가 종료되었다.
- 데몬이 프로세스 리더가 아니다.

#### 3) setsid() 호출 : 새로운 세션, 프로세스 그룹 생성
- 데몬이 프로세스 그룹, 그룹 리더가 된다.
- 제어 터미널과 관련을 맺지 않게 보장한다.

#### 4) chdir() 호출 : 작업 디렉터리를 루트 디렉터리로 변경

#### 5) 모든 파일 기술자 close


## 2. Example
```c
int main(int argc, char** argv){
	pid_t pid;
	int i;
	
	// (1) 프로세스 생성
	pid = fork();
	if(pid == -1) return -1;
	else if(pid != 0) exit(EXIT_SUCCESS); // (2)

	//(3)
	if(setsid() == -1) return -1;

	//(4)
	if(chdir("/") == -1) return -1;

	//(5) 파일 닫기 (NR_OPEN = 1024 * 1024)
	for(i = 0; i < NR_OPEN; i++)
		close(i);


	/* 데몬에서의 작업 */

	return 0;
}
```